{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nexports.__esModule = true;\nexports[\"default\"] = void 0;\nvar _mitt = _interopRequireDefault(require(\"../next-server/lib/mitt\"));\nvar _router = require(\"../next-server/lib/router/router\");\nvar _escapePathDelimiters = _interopRequireDefault(require(\"../next-server/lib/router/utils/escape-path-delimiters\"));\nvar _getAssetPathFromRoute = _interopRequireDefault(require(\"./../next-server/lib/router/utils/get-asset-path-from-route\"));\nvar _isDynamic = require(\"./../next-server/lib/router/utils/is-dynamic\");\nvar _parseRelativeUrl = require(\"./../next-server/lib/router/utils/parse-relative-url\");\nvar _querystring = require(\"./../next-server/lib/router/utils/querystring\");\nvar _routeMatcher = require(\"./../next-server/lib/router/utils/route-matcher\");\nvar _routeRegex = require(\"./../next-server/lib/router/utils/route-regex\");\nfunction hasRel(rel, link) {\n  try {\n    link = document.createElement('link');\n    return link.relList.supports(rel);\n  } catch (_unused) {}\n}\nfunction pageLoadError(route) {\n  return (0, _router.markLoadingError)(new Error(\"Error loading \".concat(route)));\n}\nvar relPrefetch = hasRel('preload') && !hasRel('prefetch') ?\n// https://caniuse.com/#feat=link-rel-preload\n// macOS and iOS (Safari does not support prefetch)\n'preload' :\n// https://caniuse.com/#feat=link-rel-prefetch\n// IE 11, Edge 12+, nearly all evergreen\n'prefetch';\nvar hasNoModule = ('noModule' in document.createElement('script'));\nvar requestIdleCallback = window.requestIdleCallback || function (cb) {\n  return setTimeout(cb, 1);\n}; /** @param {string} route */\nfunction normalizeRoute(route) {\n  if (route[0] !== '/') {\n    throw new Error(\"Route name should start with a \\\"/\\\", got \\\"\".concat(route, \"\\\"\"));\n  }\n  if (route === '/') return route;\n  return route.replace(/\\/$/, '');\n}\nfunction appendLink(href, rel, as) {\n  return new Promise(function (res, rej, link) {\n    link = document.createElement('link');\n    link.crossOrigin = process.env.__NEXT_CROSS_ORIGIN;\n    link.href = href;\n    link.rel = rel;\n    if (as) link.as = as;\n    link.onload = res;\n    link.onerror = rej;\n    document.head.appendChild(link);\n  });\n}\nvar PageLoader = /*#__PURE__*/function () {\n  function PageLoader(buildId, assetPrefix, initialPage) {\n    _classCallCheck(this, PageLoader);\n    this.buildId = buildId;\n    this.assetPrefix = assetPrefix;\n    this.pageCache = {};\n    this.pageRegisterEvents = (0, _mitt[\"default\"])();\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true\n    }; // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true;\n    }\n    if (false) {\n      this.promisedBuildManifest = new Promise(function (resolve) {\n        if (window.__BUILD_MANIFEST) {\n          resolve(window.__BUILD_MANIFEST);\n        } else {\n          window.__BUILD_MANIFEST_CB = function () {\n            resolve(window.__BUILD_MANIFEST);\n          };\n        }\n      });\n    } /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise(function (resolve) {\n      if (window.__SSG_MANIFEST) {\n        resolve(window.__SSG_MANIFEST);\n      } else {\n        window.__SSG_MANIFEST_CB = function () {\n          resolve(window.__SSG_MANIFEST);\n        };\n      }\n    });\n  } // Returns a promise for the dependencies for a particular route\n  return _createClass(PageLoader, [{\n    key: \"getDependencies\",\n    value: function getDependencies(route) {\n      var _this = this;\n      return this.promisedBuildManifest.then(function (m) {\n        var _this$pageRegisterEve;\n        return m[route] ? m[route].map(function (url) {\n          return \"\".concat(_this.assetPrefix, \"/_next/\").concat(encodeURI(url));\n        }) : (_this$pageRegisterEve = _this.pageRegisterEvents.emit(route, {\n          error: pageLoadError(route)\n        })) != null ? _this$pageRegisterEve : [];\n      });\n    } /**\n      * @param {string} href the route href (file-system path)\n      * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n      */\n  }, {\n    key: \"getDataHref\",\n    value: function getDataHref(href, asPath, ssg) {\n      var _this2 = this;\n      var _ref = (0, _parseRelativeUrl.parseRelativeUrl)(href),\n        hrefPathname = _ref.pathname,\n        searchParams = _ref.searchParams,\n        search = _ref.search;\n      var query = (0, _querystring.searchParamsToUrlQuery)(searchParams);\n      var _ref2 = (0, _parseRelativeUrl.parseRelativeUrl)(asPath),\n        asPathname = _ref2.pathname;\n      var route = normalizeRoute(hrefPathname);\n      var getHrefForSlug = /** @type string */function getHrefForSlug(path) {\n        var dataRoute = (0, _getAssetPathFromRoute[\"default\"])(path, '.json');\n        return (0, _router.addBasePath)(\"/_next/data/\".concat(_this2.buildId).concat(dataRoute).concat(ssg ? '' : search));\n      };\n      var isDynamic = (0, _isDynamic.isDynamicRoute)(route),\n        interpolatedRoute;\n      if (isDynamic) {\n        var dynamicRegex = (0, _routeRegex.getRouteRegex)(route);\n        var dynamicGroups = dynamicRegex.groups;\n        var dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        (0, _routeMatcher.getRouteMatcher)(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query;\n        interpolatedRoute = route;\n        if (!Object.keys(dynamicGroups).every(function (param) {\n          var value = dynamicMatches[param] || '';\n          var _dynamicGroups$param = dynamicGroups[param],\n            repeat = _dynamicGroups$param.repeat,\n            optional = _dynamicGroups$param.optional; // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          var replaced = \"[\".concat(repeat ? '...' : '').concat(param, \"]\");\n          if (optional) {\n            replaced = \"\".concat(!value ? '/' : '', \"[\").concat(replaced, \"]\");\n          }\n          if (repeat && !Array.isArray(value)) value = [value];\n          return (optional || param in dynamicMatches) && (\n          // Interpolate group into data URL if present\n          interpolatedRoute = interpolatedRoute.replace(replaced, repeat ? value.map(_escapePathDelimiters[\"default\"]).join('/') : (0, _escapePathDelimiters[\"default\"])(value)) || '/');\n        })) {\n          interpolatedRoute = ''; // did not satisfy all requirements\n          // n.b. We ignore this error because we handle warning for this case in\n          // development in the `<Link>` component directly.\n        }\n      }\n      return isDynamic ? interpolatedRoute && getHrefForSlug(interpolatedRoute) : getHrefForSlug(route);\n    } /**\n      * @param {string} href the route href (file-system path)\n      * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n      */\n  }, {\n    key: \"prefetchData\",\n    value: function prefetchData(href, asPath) {\n      var _this3 = this;\n      var _ref3 = (0, _parseRelativeUrl.parseRelativeUrl)(href),\n        hrefPathname = _ref3.pathname;\n      var route = normalizeRoute(hrefPathname);\n      return this.promisedSsgManifest.then(function (s, _dataHref) {\n        requestIdleCallback(function () {\n          // Check if the route requires a data file\n          s.has(route) && (\n          // Try to generate data href, noop when falsy\n          _dataHref = _this3.getDataHref(href, asPath, true)) &&\n          // noop when data has already been prefetched (dedupe)\n          !document.querySelector(\"link[rel=\\\"\".concat(relPrefetch, \"\\\"][href^=\\\"\").concat(_dataHref, \"\\\"]\")) &&\n          // Inject the `<link rel=prefetch>` tag for above computed `href`.\n          appendLink(_dataHref, relPrefetch, 'fetch');\n        });\n      });\n    }\n  }, {\n    key: \"loadPage\",\n    value: function loadPage(route) {\n      var _this4 = this;\n      route = normalizeRoute(route);\n      return new Promise(function (resolve, reject) {\n        // If there's a cached version of the page, let's use it.\n        var cachedPage = _this4.pageCache[route];\n        if (cachedPage) {\n          var error = cachedPage.error,\n            page = cachedPage.page,\n            mod = cachedPage.mod;\n          error ? reject(error) : resolve({\n            page: page,\n            mod: mod\n          });\n          return;\n        }\n        var fire = function fire(_ref4) {\n          var error = _ref4.error,\n            page = _ref4.page,\n            mod = _ref4.mod;\n          _this4.pageRegisterEvents.off(route, fire);\n          delete _this4.loadingRoutes[route];\n          if (error) {\n            reject(error);\n          } else {\n            resolve({\n              page: page,\n              mod: mod\n            });\n          }\n        }; // Register a listener to get the page\n        _this4.pageRegisterEvents.on(route, fire);\n        if (!_this4.loadingRoutes[route]) {\n          _this4.loadingRoutes[route] = true;\n          if (false) {\n            _this4.getDependencies(route).then(function (deps) {\n              deps.forEach(function (d) {\n                if (d.endsWith('.js') && !document.querySelector(\"script[src^=\\\"\".concat(d, \"\\\"]\"))) {\n                  _this4.loadScript(d, route);\n                }\n                if (d.endsWith('.css') && !document.querySelector(\"link[rel=stylesheet][href^=\\\"\".concat(d, \"\\\"]\"))) {\n                  appendLink(d, 'stylesheet')[\"catch\"](function () {// FIXME: handle failure\n                    // Right now, this is needed to prevent an unhandled rejection.\n                  });\n                }\n              });\n            });\n          } else {\n            // Development only. In production the page file is part of the build manifest\n            route = normalizeRoute(route);\n            var scriptRoute = (0, _getAssetPathFromRoute[\"default\"])(route, '.js');\n            var url = \"\".concat(_this4.assetPrefix, \"/_next/static/chunks/pages\").concat(encodeURI(scriptRoute));\n            _this4.loadScript(url, route);\n          }\n        }\n      });\n    }\n  }, {\n    key: \"loadScript\",\n    value: function loadScript(url, route) {\n      var _this5 = this;\n      var script = document.createElement('script');\n      if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n        script.type = 'module';\n      }\n      script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN;\n      script.src = url;\n      script.onerror = function () {\n        _this5.pageRegisterEvents.emit(route, {\n          error: pageLoadError(url)\n        });\n      };\n      document.body.appendChild(script);\n    } // This method if called by the route code.\n  }, {\n    key: \"registerPage\",\n    value: function registerPage(route, regFn) {\n      var _this6 = this;\n      var register = function register() {\n        try {\n          var mod = regFn();\n          var pageData = {\n            page: mod[\"default\"] || mod,\n            mod: mod\n          };\n          _this6.pageCache[route] = pageData;\n          _this6.pageRegisterEvents.emit(route, pageData);\n        } catch (error) {\n          _this6.pageCache[route] = {\n            error: error\n          };\n          _this6.pageRegisterEvents.emit(route, {\n            error: error\n          });\n        }\n      };\n      if (true) {\n        // Wait for webpack to become idle if it's not.\n        // More info: https://github.com/vercel/next.js/pull/1511\n        if (module.hot && module.hot.status() !== 'idle') {\n          console.log(\"Waiting for webpack to become \\\"idle\\\" to initialize the page: \\\"\".concat(route, \"\\\"\"));\n          var check = function check(status) {\n            if (status === 'idle') {\n              module.hot.removeStatusHandler(check);\n              register();\n            }\n          };\n          module.hot.status(check);\n          return;\n        }\n      }\n      register();\n    } /**\n      * @param {string} route\n      * @param {boolean} [isDependency]\n      */\n  }, {\n    key: \"prefetch\",\n    value: function prefetch(route, isDependency) {\n      var _this7 = this;\n      // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n      // License: Apache 2.0\n      var cn;\n      if (cn = navigator.connection) {\n        // Don't prefetch if using 2G or if Save-Data is enabled.\n        if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve();\n      } /** @type {string} */\n      var url;\n      if (isDependency) {\n        url = route;\n      } else {\n        if (true) {\n          route = normalizeRoute(route);\n          var ext = process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js';\n          var scriptRoute = (0, _getAssetPathFromRoute[\"default\"])(route, ext);\n          url = \"\".concat(this.assetPrefix, \"/_next/static/\").concat(encodeURIComponent(this.buildId), \"/pages\").concat(encodeURI(scriptRoute));\n        }\n      }\n      return Promise.all(document.querySelector(\"link[rel=\\\"\".concat(relPrefetch, \"\\\"][href^=\\\"\").concat(url, \"\\\"]\")) ? [] : [url && appendLink(url, relPrefetch, url.endsWith('.css') ? 'style' : 'script'), false && !isDependency && this.getDependencies(route).then(function (urls) {\n        return Promise.all(urls.map(function (dependencyUrl) {\n          return _this7.prefetch(dependencyUrl, true);\n        }));\n      })]).then(\n      // do not return any data\n      function () {},\n      // swallow prefetch errors\n      function () {});\n    }\n  }]);\n}();\nexports[\"default\"] = PageLoader;","map":{"version":3,"sources":["../../client/page-loader.js"],"names":["hasRel","rel","link","document","createElement","relList","supports","pageLoadError","route","Error","relPrefetch","hasNoModule","requestIdleCallback","window","cb","setTimeout","normalizeRoute","replace","appendLink","href","as","Promise","res","rej","crossOrigin","process","env","__NEXT_CROSS_ORIGIN","onload","onerror","head","appendChild","PageLoader","constructor","buildId","assetPrefix","initialPage","pageCache","pageRegisterEvents","loadingRoutes","promisedBuildManifest","resolve","__BUILD_MANIFEST","__BUILD_MANIFEST_CB","promisedSsgManifest","__SSG_MANIFEST","__SSG_MANIFEST_CB","getDependencies","then","m","map","url","encodeURI","emit","error","getDataHref","asPath","ssg","pathname","hrefPathname","searchParams","search","query","asPathname","getHrefForSlug","path","dataRoute","isDynamic","interpolatedRoute","dynamicRegex","dynamicGroups","groups","dynamicMatches","Object","keys","every","param","value","repeat","optional","replaced","Array","isArray","escapePathDelimiters","join","prefetchData","s","_dataHref","has","querySelector","loadPage","reject","cachedPage","page","mod","fire","off","on","deps","forEach","d","endsWith","loadScript","scriptRoute","script","__NEXT_MODERN_BUILD","type","src","body","registerPage","regFn","register","pageData","module","hot","status","console","log","check","removeStatusHandler","prefetch","isDependency","cn","navigator","connection","saveData","test","effectiveType","ext","encodeURIComponent","all","urls","dependencyUrl"],"mappings":"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","sourcesContent":["import mitt from '../next-server/lib/mitt'\nimport { addBasePath, markLoadingError } from '../next-server/lib/router/router'\nimport escapePathDelimiters from '../next-server/lib/router/utils/escape-path-delimiters'\nimport getAssetPathFromRoute from './../next-server/lib/router/utils/get-asset-path-from-route'\nimport { isDynamicRoute } from './../next-server/lib/router/utils/is-dynamic'\nimport { parseRelativeUrl } from './../next-server/lib/router/utils/parse-relative-url'\nimport { searchParamsToUrlQuery } from './../next-server/lib/router/utils/querystring'\nimport { getRouteMatcher } from './../next-server/lib/router/utils/route-matcher'\nimport { getRouteRegex } from './../next-server/lib/router/utils/route-regex'\n\nfunction hasRel(rel, link) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nfunction pageLoadError(route) {\n  return markLoadingError(new Error(`Error loading ${route}`))\n}\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\nconst requestIdleCallback =\n  window.requestIdleCallback ||\n  function (cb) {\n    return setTimeout(cb, 1)\n  }\n\n/** @param {string} route */\nfunction normalizeRoute(route) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(href, rel, as) {\n  return new Promise((res, rej, link) => {\n    link = document.createElement('link')\n    link.crossOrigin = process.env.__NEXT_CROSS_ORIGIN\n    link.href = href\n    link.rel = rel\n    if (as) link.as = as\n\n    link.onload = res\n    link.onerror = rej\n\n    document.head.appendChild(link)\n  })\n}\n\nexport default class PageLoader {\n  constructor(buildId, assetPrefix, initialPage) {\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true,\n    }\n\n    // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true\n    }\n\n    if (process.env.NODE_ENV === 'production') {\n      this.promisedBuildManifest = new Promise((resolve) => {\n        if (window.__BUILD_MANIFEST) {\n          resolve(window.__BUILD_MANIFEST)\n        } else {\n          window.__BUILD_MANIFEST_CB = () => {\n            resolve(window.__BUILD_MANIFEST)\n          }\n        }\n      })\n    }\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if (window.__SSG_MANIFEST) {\n        resolve(window.__SSG_MANIFEST)\n      } else {\n        window.__SSG_MANIFEST_CB = () => {\n          resolve(window.__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  getDependencies(route) {\n    return this.promisedBuildManifest.then((m) => {\n      return m[route]\n        ? m[route].map((url) => `${this.assetPrefix}/_next/${encodeURI(url)}`)\n        : this.pageRegisterEvents.emit(route, {\n            error: pageLoadError(route),\n          }) ?? []\n    })\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(href, asPath, ssg) {\n    const { pathname: hrefPathname, searchParams, search } = parseRelativeUrl(\n      href\n    )\n    const query = searchParamsToUrlQuery(searchParams)\n    const { pathname: asPathname } = parseRelativeUrl(asPath)\n    const route = normalizeRoute(hrefPathname)\n\n    const getHrefForSlug = (/** @type string */ path) => {\n      const dataRoute = getAssetPathFromRoute(path, '.json')\n      return addBasePath(\n        `/_next/data/${this.buildId}${dataRoute}${ssg ? '' : search}`\n      )\n    }\n\n    let isDynamic = isDynamicRoute(route),\n      interpolatedRoute\n    if (isDynamic) {\n      const dynamicRegex = getRouteRegex(route)\n      const dynamicGroups = dynamicRegex.groups\n      const dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        getRouteMatcher(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query\n\n      interpolatedRoute = route\n      if (\n        !Object.keys(dynamicGroups).every((param) => {\n          let value = dynamicMatches[param] || ''\n          const { repeat, optional } = dynamicGroups[param]\n\n          // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          let replaced = `[${repeat ? '...' : ''}${param}]`\n          if (optional) {\n            replaced = `${!value ? '/' : ''}[${replaced}]`\n          }\n          if (repeat && !Array.isArray(value)) value = [value]\n\n          return (\n            (optional || param in dynamicMatches) &&\n            // Interpolate group into data URL if present\n            (interpolatedRoute =\n              interpolatedRoute.replace(\n                replaced,\n                repeat\n                  ? value.map(escapePathDelimiters).join('/')\n                  : escapePathDelimiters(value)\n              ) || '/')\n          )\n        })\n      ) {\n        interpolatedRoute = '' // did not satisfy all requirements\n\n        // n.b. We ignore this error because we handle warning for this case in\n        // development in the `<Link>` component directly.\n      }\n    }\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href, asPath) {\n    const { pathname: hrefPathname } = parseRelativeUrl(href)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest.then((s, _dataHref) => {\n      requestIdleCallback(() => {\n        // Check if the route requires a data file\n        s.has(route) &&\n          // Try to generate data href, noop when falsy\n          (_dataHref = this.getDataHref(href, asPath, true)) &&\n          // noop when data has already been prefetched (dedupe)\n          !document.querySelector(\n            `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n          ) &&\n          // Inject the `<link rel=prefetch>` tag for above computed `href`.\n          appendLink(_dataHref, relPrefetch, 'fetch')\n      })\n    })\n  }\n\n  loadPage(route) {\n    route = normalizeRoute(route)\n\n    return new Promise((resolve, reject) => {\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        const { error, page, mod } = cachedPage\n        error ? reject(error) : resolve({ page, mod })\n        return\n      }\n\n      const fire = ({ error, page, mod }) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if (error) {\n          reject(error)\n        } else {\n          resolve({ page, mod })\n        }\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.NODE_ENV === 'production') {\n          this.getDependencies(route).then((deps) => {\n            deps.forEach((d) => {\n              if (\n                d.endsWith('.js') &&\n                !document.querySelector(`script[src^=\"${d}\"]`)\n              ) {\n                this.loadScript(d, route)\n              }\n              if (\n                d.endsWith('.css') &&\n                !document.querySelector(`link[rel=stylesheet][href^=\"${d}\"]`)\n              ) {\n                appendLink(d, 'stylesheet').catch(() => {\n                  // FIXME: handle failure\n                  // Right now, this is needed to prevent an unhandled rejection.\n                })\n              }\n            })\n          })\n        } else {\n          // Development only. In production the page file is part of the build manifest\n          route = normalizeRoute(route)\n          let scriptRoute = getAssetPathFromRoute(route, '.js')\n\n          const url = `${this.assetPrefix}/_next/static/chunks/pages${encodeURI(\n            scriptRoute\n          )}`\n          this.loadScript(url, route)\n        }\n      }\n    })\n  }\n\n  loadScript(url, route) {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n    }\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN\n    script.src = url\n    script.onerror = () => {\n      this.pageRegisterEvents.emit(route, { error: pageLoadError(url) })\n    }\n    document.body.appendChild(script)\n  }\n\n  // This method if called by the route code.\n  registerPage(route, regFn) {\n    const register = () => {\n      try {\n        const mod = regFn()\n        const pageData = { page: mod.default || mod, mod }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if (module.hot && module.hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status) => {\n          if (status === 'idle') {\n            module.hot.removeStatusHandler(check)\n            register()\n          }\n        }\n        module.hot.status(check)\n        return\n      }\n    }\n\n    register()\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route, isDependency) {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = navigator.connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        route = normalizeRoute(route)\n\n        const ext =\n          process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js'\n        const scriptRoute = getAssetPathFromRoute(route, ext)\n\n        url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n          this.buildId\n        )}/pages${encodeURI(scriptRoute)}`\n      }\n    }\n\n    return Promise.all(\n      document.querySelector(`link[rel=\"${relPrefetch}\"][href^=\"${url}\"]`)\n        ? []\n        : [\n            url &&\n              appendLink(\n                url,\n                relPrefetch,\n                url.endsWith('.css') ? 'style' : 'script'\n              ),\n            process.env.NODE_ENV === 'production' &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(\n                  urls.map((dependencyUrl) =>\n                    this.prefetch(dependencyUrl, true)\n                  )\n                )\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"script"}
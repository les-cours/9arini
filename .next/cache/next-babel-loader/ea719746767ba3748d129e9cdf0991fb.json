{"ast":null,"code":"var _jsxFileName = \"/home/chouaib/code/learn/frontend/contexts/AuthContext.tsx\";\nvar __jsx = React.createElement;\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport Axios from \"axios\";\nimport jwt from \"jwt-decode\";\nimport { isEqual } from \"lodash\";\nimport client from \"./Auth\";\nimport { AuthCtx } from \"AuthCtx\";\nimport appRoutes from \"Providers/appRoutes\";\nimport { getUserOperatingSystem } from \"Utils/funcs\";\nconst AuthProvider = ({\n  children\n}) => {\n  const {\n    i18n\n  } = useTranslation();\n  const {\n    0: auth,\n    1: setAuth\n  } = useState({\n    authenticated: false,\n    agent: {}\n  });\n  const {\n    0: checkingToken,\n    1: setCheckingToken\n  } = useState(true);\n  const history = useHistory();\n  const tokenRef = useRef(void 0);\n  const tokenTypeRef = useRef(void 0);\n  const callBackURLRef = useRef(void 0);\n  const tokenExipresAtRef = useRef(0);\n  const tokenRefreshTimoutRef = useRef(0);\n  const onLoginSucceedHandlerRef = useRef(function () {});\n  const cleaners = useRef(null);\n  const onSaveTokenHandler = useCallback(userAuth => {\n    var _userAuth$user, _userAuth$user2;\n    window.localStorage.setItem(\"id_token\", (_userAuth$user = userAuth.user) === null || _userAuth$user === void 0 ? void 0 : _userAuth$user.accessToken);\n    window.localStorage.setItem(\"token_type\", (_userAuth$user2 = userAuth.user) === null || _userAuth$user2 === void 0 ? void 0 : _userAuth$user2.tokenType);\n  }, []);\n  const onLogOutHandler = useCallback(async () => {\n    try {\n      clearTimeout(tokenRefreshTimoutRef.current);\n      await Axios.post(`${process.env.APP_AUTH_SERVICE}logout`, null, {\n        withCredentials: true\n      });\n      setAuth({\n        authenticated: false,\n        agent: {}\n      });\n      cleaners.current();\n      localStorage.removeItem(\"id_token\");\n      history.push(appRoutes.login(i18n.language), {\n        logout: true\n      });\n      return true;\n    } catch (error) {\n      console.error(error);\n      return false;\n    }\n  }, [history]);\n  onLoginSucceedHandlerRef.current = userAuth => {\n    const {\n      accessToken,\n      tokenType,\n      expiresIn\n    } = userAuth.user;\n    const userDetails = jwt(accessToken);\n    tokenRef.current = accessToken;\n    tokenTypeRef.current = tokenType;\n    tokenExipresAtRef.current = expiresIn;\n    //@ts-ignore\n    userDetails.agentID = userDetails.id;\n    delete userDetails.exp;\n    if (auth.authenticated && isEqual(auth.agent, userDetails)) {\n      // Same user details no need to re-render\n      return;\n    }\n    setAuth(_objectSpread({\n      authenticated: true,\n      agent: userDetails\n    }, userDetails));\n  };\n  const onRefreshTokenHandler = useCallback(expireAt => {\n    let numberOfRetry = 0;\n    async function refresh() {\n      try {\n        const {\n          data: userAuth\n        } = await Axios.post(`${process.env.APP_AUTH_SERVICE}refresh`, null, {\n          withCredentials: true\n        });\n        onLoginSucceedHandlerRef.current(userAuth);\n        onSaveTokenHandler(userAuth);\n        onRefreshTokenHandler(userAuth.user.expiresIn * 1000);\n      } catch (error) {\n        numberOfRetry++;\n        console.error(error);\n        if (numberOfRetry > parseInt(process.env.MAX_REFRESH_TOKEN_ATTEMPS)) {\n          onLogOutHandler();\n          return;\n        }\n\n        // Retry again\n        tokenRefreshTimoutRef.current = setTimeout(refresh, 10000);\n      }\n    }\n    tokenRefreshTimoutRef.current = setTimeout(refresh, expireAt - Date.now() - 5000);\n  }, [onLogOutHandler]);\n  const onLoginHandler = useCallback(async login => {\n    try {\n      const osname = getUserOperatingSystem();\n      const {\n        data: userAuth\n      } = await Axios.post(`${process.env.APP_AUTH_SERVICE}login`, _objectSpread(_objectSpread({}, login), {}, {\n        osname\n      }), {\n        withCredentials: true,\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n        },\n        validateStatus() {\n          return true;\n        }\n      });\n      if (typeof userAuth.error === \"object\") {\n        setAuth({\n          authenticated: false,\n          agent: {}\n        });\n        return {\n          error: userAuth.error\n        };\n      }\n      onLoginSucceedHandlerRef.current(userAuth);\n      onSaveTokenHandler(userAuth);\n      onRefreshTokenHandler(userAuth.user.expiresIn * 1000);\n      return {\n        token: `${userAuth.user.tokenType} ${userAuth.user.accessToken}`\n      };\n    } catch (e) {\n      setAuth({\n        authenticated: false,\n        agent: {}\n      });\n      return {\n        error: {\n          message: e.message\n        }\n      };\n    }\n  }, [client]);\n  const authenticateToken = useCallback(async (triggerAutoRefresh = false) => {\n    try {\n      if (triggerAutoRefresh) {\n        setCheckingToken(true);\n      }\n      const {\n        data: userAuth\n      } = await Axios.post(`${process.env.APP_AUTH_SERVICE}refresh`, null, {\n        withCredentials: true\n      });\n      onLoginSucceedHandlerRef.current(userAuth);\n      onSaveTokenHandler(userAuth);\n      if (triggerAutoRefresh) {\n        onRefreshTokenHandler(userAuth.user.expiresIn * 1000);\n      }\n      return true;\n    } catch (error) {\n      console.error(error);\n      return false;\n    } finally {\n      if (triggerAutoRefresh) {\n        setCheckingToken(false);\n      }\n    }\n  }, [client]);\n  const onSignupRedirectHandler = useCallback(async (token, tokenType) => {\n    try {\n      const details = jwt(token);\n      tokenRef.current = token;\n      tokenTypeRef.current = tokenType;\n      tokenExipresAtRef.current = details === null || details === void 0 ? void 0 : details.exp;\n      onRefreshTokenHandler((details === null || details === void 0 ? void 0 : details.exp) * 1000);\n      setAuth(_objectSpread({\n        authenticated: true,\n        agent: details\n      }, details));\n      return true;\n    } catch (error) {\n      console.error(error);\n      setAuth({\n        authenticated: false,\n        agent: {}\n      });\n      return false;\n    }\n  }, []);\n  const token = useCallback(async () => {\n    // We have 4secondes or more in life the current token\n    if (tokenExipresAtRef.current - Date.now() / 1000 >= 4) {\n      return `${tokenTypeRef.current} ${tokenRef.current}`;\n    }\n    return new Promise(resolver => {\n      let cycleCount = 0;\n      const tokenWaiter = function () {\n        setTimeout(() => {\n          if (tokenExipresAtRef.current - Date.now() / 1000 >= 4) {\n            return resolver(`${tokenTypeRef.current} ${tokenRef.current}`);\n          }\n          cycleCount++;\n          if (cycleCount > 10) {\n            return resolver(\"\");\n          }\n          tokenWaiter();\n        }, 1000);\n      };\n    });\n  }, []);\n  const onAddOnLogoutClean = useCallback(cleanupFunction => {\n    cleaners.current = cleanupFunction;\n  }, []);\n  useEffect(() => {\n    if ([appRoutes.login(), appRoutes.reset(), appRoutes.forgot(), appRoutes.confirm(), appRoutes.signup()].findIndex(route => new RegExp(route.replace(/\\/$/, \"\")).test(window.location.pathname)) === -1) {\n      callBackURLRef.current = window.location.href.replace(window.location.origin, \"\");\n    }\n  }, [window.location.href]);\n  useEffect(() => {\n    authenticateToken(true).then(response => {\n      if (response) {\n        history.push(callBackURLRef.current || appRoutes.webRTC(i18n.language));\n      }\n    });\n  }, []);\n  useEffect(() => {\n    const onLocalStorageChangeHandler = function () {\n      const token = window.localStorage.getItem(\"id_token\");\n      const tokenType = window.localStorage.getItem(\"token_type\");\n      if (typeof token !== \"string\" || typeof tokenType !== \"string\") {\n        onLogOutHandler();\n      }\n    };\n    window.addEventListener(\"storage\", onLocalStorageChangeHandler);\n    return () => {\n      window.removeEventListener(\"storage\", onLocalStorageChangeHandler);\n    };\n  }, []);\n  if (checkingToken) {\n    return __jsx(Loader, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 16\n      }\n    });\n  }\n  return __jsx(AuthCtx.Provider, {\n    value: _objectSpread(_objectSpread({}, auth), {}, {\n      callbackURL: callBackURLRef.current,\n      token,\n      addOnLogoutClean: onAddOnLogoutClean,\n      login: onLoginHandler,\n      logout: onLogOutHandler,\n      refreshTokenNow: authenticateToken,\n      refreshToken: onRefreshTokenHandler,\n      RedirectOnSingupCompletion: onSignupRedirectHandler\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 9\n    }\n  }, children);\n};\nexport default React.memo(AuthProvider);","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","Axios","jwt","isEqual","client","AuthCtx","appRoutes","getUserOperatingSystem","AuthProvider","children","i18n","useTranslation","auth","setAuth","authenticated","agent","checkingToken","setCheckingToken","history","useHistory","tokenRef","tokenTypeRef","callBackURLRef","tokenExipresAtRef","tokenRefreshTimoutRef","onLoginSucceedHandlerRef","cleaners","onSaveTokenHandler","userAuth","_userAuth$user","_userAuth$user2","window","localStorage","setItem","user","accessToken","tokenType","onLogOutHandler","clearTimeout","current","post","process","env","APP_AUTH_SERVICE","withCredentials","removeItem","push","login","language","logout","error","console","expiresIn","userDetails","agentID","id","exp","_objectSpread","onRefreshTokenHandler","expireAt","numberOfRetry","refresh","data","parseInt","MAX_REFRESH_TOKEN_ATTEMPS","setTimeout","Date","now","onLoginHandler","osname","headers","validateStatus","token","e","message","authenticateToken","triggerAutoRefresh","onSignupRedirectHandler","details","Promise","resolver","cycleCount","tokenWaiter","onAddOnLogoutClean","cleanupFunction","reset","forgot","confirm","signup","findIndex","route","RegExp","replace","test","location","pathname","href","origin","then","response","webRTC","onLocalStorageChangeHandler","getItem","addEventListener","removeEventListener","__jsx","Loader","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","Provider","value","callbackURL","addOnLogoutClean","refreshTokenNow","refreshToken","RedirectOnSingupCompletion","memo"],"sources":["/home/chouaib/code/learn/frontend/contexts/AuthContext.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from \"react\";\n\nimport Axios from \"axios\";\nimport jwt from \"jwt-decode\";\nimport { isEqual } from \"lodash\";\nimport client from \"./Auth\"\nimport { AuthCtx } from \"AuthCtx\";\nimport appRoutes from \"Providers/appRoutes\";\nimport { useAppDispatch } from \"Redux/helpers\";\nimport { getUserOperatingSystem } from \"Utils/funcs\";\n\ninterface UserAuth {\n    user?: {\n        accessToken: string;\n        tokenType: string;\n        expiresIn: number;\n    };\n    error?: {\n        message: string;\n    };\n}\n\nconst AuthProvider = ({ children }) => {\n    const { i18n } = useTranslation();\n    const [auth, setAuth] = useState({ authenticated: false, agent: {} });\n    const [checkingToken, setCheckingToken] = useState(true);\n    const history = useHistory();\n    const tokenRef = useRef<string | undefined>(void 0);\n    const tokenTypeRef = useRef<string | undefined>(void 0);\n    const callBackURLRef = useRef<string | undefined>(void 0);\n    const tokenExipresAtRef = useRef(0);\n    const tokenRefreshTimoutRef = useRef<NodeJS.Timeout | number>(0);\n    const onLoginSucceedHandlerRef = useRef<(user: UserAuth) => void>(function () {});\n    const cleaners = useRef<() => void>(null);\n\n    const onSaveTokenHandler = useCallback((userAuth: UserAuth) => {\n        window.localStorage.setItem(\"id_token\", userAuth.user?.accessToken);\n        window.localStorage.setItem(\"token_type\", userAuth.user?.tokenType);\n    }, []);\n\n    const onLogOutHandler = useCallback(async () => {\n        try {\n            clearTimeout(tokenRefreshTimoutRef.current as number);\n            await Axios.post(`${process.env.APP_AUTH_SERVICE}logout`, null, {\n                withCredentials: true,\n            });\n            setAuth({ authenticated: false, agent: {} });\n            cleaners.current();\n            localStorage.removeItem(\"id_token\");\n            history.push(appRoutes.login(i18n.language), { logout: true });\n            return true;\n        } catch (error) {\n            console.error(error);\n            return false;\n        }\n    }, [history]);\n\n    onLoginSucceedHandlerRef.current = (userAuth: UserAuth) => {\n        const { accessToken, tokenType, expiresIn } = userAuth.user;\n        const userDetails = jwt(accessToken);\n        tokenRef.current = accessToken;\n        tokenTypeRef.current = tokenType;\n        tokenExipresAtRef.current = expiresIn;\n        //@ts-ignore\n        userDetails.agentID = userDetails.id;\n        delete (userDetails as any).exp;\n        if (auth.authenticated && isEqual(auth.agent, userDetails)) {\n            // Same user details no need to re-render\n            return;\n        }\n\n        setAuth({\n            authenticated: true,\n            agent: userDetails,\n            ...(userDetails as any),\n        });\n    };\n\n    const onRefreshTokenHandler = useCallback(\n        (expireAt: number) => {\n            let numberOfRetry = 0;\n            async function refresh() {\n                try {\n                    const { data: userAuth } = await Axios.post<UserAuth>(\n                        `${process.env.APP_AUTH_SERVICE}refresh`,\n                        null,\n                        { withCredentials: true }\n                    );\n\n                    onLoginSucceedHandlerRef.current(userAuth);\n                    onSaveTokenHandler(userAuth);\n                    onRefreshTokenHandler(userAuth.user.expiresIn * 1000);\n                } catch (error) {\n                    numberOfRetry++;\n                    console.error(error);\n                    if (numberOfRetry > parseInt(process.env.MAX_REFRESH_TOKEN_ATTEMPS)) {\n                        onLogOutHandler();\n                        return;\n                    }\n\n                    // Retry again\n                    tokenRefreshTimoutRef.current = setTimeout(refresh, 10000);\n                }\n            }\n            tokenRefreshTimoutRef.current = setTimeout(refresh, expireAt - Date.now() - 5000);\n        },\n        [onLogOutHandler]\n    );\n\n    const onLoginHandler = useCallback(\n        async (login: {\n            username: string;\n            password: string;\n        }): Promise<{ token?: string; error?: { message: string } }> => {\n            try {\n                const osname = getUserOperatingSystem();\n                const { data: userAuth } = await Axios.post<UserAuth>(\n                    `${process.env.APP_AUTH_SERVICE}login`,\n                    { ...login, osname },\n                    {\n                        withCredentials: true,\n                        headers: {\n                            \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\",\n                        },\n                        validateStatus() {\n                            return true;\n                        },\n                    }\n                );\n                if (typeof userAuth.error === \"object\") {\n                    setAuth({ authenticated: false, agent: {} });\n                    return { error: userAuth.error };\n                }\n\n                onLoginSucceedHandlerRef.current(userAuth);\n                onSaveTokenHandler(userAuth);\n                onRefreshTokenHandler(userAuth.user.expiresIn * 1000);\n                return { token: `${userAuth.user.tokenType} ${userAuth.user.accessToken}` };\n            } catch (e) {\n                setAuth({ authenticated: false, agent: {} });\n                return { error: { message: e.message } };\n            }\n        },\n        [client]\n    );\n\n    const authenticateToken = useCallback(\n        async (triggerAutoRefresh = false): Promise<boolean> => {\n            try {\n                if (triggerAutoRefresh) {\n                    setCheckingToken(true);\n                }\n\n                const { data: userAuth } = await Axios.post<UserAuth>(\n                    `${process.env.APP_AUTH_SERVICE}refresh`,\n                    null,\n                    { withCredentials: true }\n                );\n\n                onLoginSucceedHandlerRef.current(userAuth);\n                onSaveTokenHandler(userAuth);\n                if (triggerAutoRefresh) {\n                    onRefreshTokenHandler(userAuth.user.expiresIn * 1000);\n                }\n\n                return true;\n            } catch (error) {\n                console.error(error);\n                return false;\n            } finally {\n                if (triggerAutoRefresh) {\n                    setCheckingToken(false);\n                }\n            }\n        },\n        [client]\n    );\n\n    const onSignupRedirectHandler = useCallback(\n        async (token: string, tokenType: string): Promise<boolean> => {\n            try {\n                const details: any = jwt(token);\n                tokenRef.current = token;\n                tokenTypeRef.current = tokenType;\n                tokenExipresAtRef.current = details?.exp;\n                onRefreshTokenHandler(details?.exp * 1000);\n                setAuth({\n                    authenticated: true,\n                    agent: details,\n                    ...(details as any),\n                });\n                return true;\n            } catch (error) {\n                console.error(error);\n                setAuth({ authenticated: false, agent: {} });\n                return false;\n            }\n        },\n        []\n    );\n\n    const token = useCallback(async (): Promise<string> => {\n        // We have 4secondes or more in life the current token\n        if (tokenExipresAtRef.current - Date.now() / 1000 >= 4) {\n            return `${tokenTypeRef.current} ${tokenRef.current}`;\n        }\n\n        return new Promise((resolver) => {\n            let cycleCount = 0;\n            const tokenWaiter = function () {\n                setTimeout(() => {\n                    if (tokenExipresAtRef.current - Date.now() / 1000 >= 4) {\n                        return resolver(`${tokenTypeRef.current} ${tokenRef.current}`);\n                    }\n\n                    cycleCount++;\n                    if (cycleCount > 10) {\n                        return resolver(\"\");\n                    }\n\n                    tokenWaiter();\n                }, 1000);\n            };\n        });\n    }, []);\n\n    const onAddOnLogoutClean = useCallback((cleanupFunction: () => void) => {\n        cleaners.current = cleanupFunction;\n    }, []);\n\n    useEffect(() => {\n        if (\n            [\n                appRoutes.login(),\n                appRoutes.reset(),\n                appRoutes.forgot(),\n                appRoutes.confirm(),\n                appRoutes.signup(),\n            ].findIndex((route) =>\n                new RegExp(route.replace(/\\/$/, \"\")).test(window.location.pathname)\n            ) === -1\n        ) {\n            callBackURLRef.current = window.location.href.replace(window.location.origin, \"\");\n        }\n    }, [window.location.href]);\n\n    useEffect(() => {\n        authenticateToken(true).then((response) => {\n            if (response) {\n                history.push(callBackURLRef.current || appRoutes.webRTC(i18n.language));\n            }\n        });\n    }, []);\n\n    useEffect(() => {\n        const onLocalStorageChangeHandler = function () {\n            const token = window.localStorage.getItem(\"id_token\");\n            const tokenType = window.localStorage.getItem(\"token_type\");\n            if (typeof token !== \"string\" || typeof tokenType !== \"string\") {\n                onLogOutHandler();\n            }\n        };\n\n        window.addEventListener(\"storage\", onLocalStorageChangeHandler);\n        return () => {\n            window.removeEventListener(\"storage\", onLocalStorageChangeHandler);\n        };\n    }, []);\n\n    if (checkingToken) {\n        return <Loader />;\n    }\n    return (\n        <AuthCtx.Provider\n            value={{\n                ...auth,\n                callbackURL: callBackURLRef.current,\n                token,\n                addOnLogoutClean: onAddOnLogoutClean,\n                login: onLoginHandler,\n                logout: onLogOutHandler,\n                refreshTokenNow: authenticateToken,\n                refreshToken: onRefreshTokenHandler,\n                RedirectOnSingupCompletion: onSignupRedirectHandler,\n            }}\n        >\n            {children}\n        </AuthCtx.Provider>\n    );\n};\n\nexport default React.memo(AuthProvider);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}